/*----------------------------------------------------------------------------*/
/*ncache.h*/
/*----------------------------------------------------------------------------*/
/*The cache of nodes*/
/*----------------------------------------------------------------------------*/
#ifndef __NCACHE_H__
#define __NCACHE_H__

/*----------------------------------------------------------------------------*/
#include <error.h>
#include <hurd/netfs.h>
/*----------------------------------------------------------------------------*/
#include "node.h"
/*----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*/
/*--------Macros--------------------------------------------------------------*/
/*The default maximal cache size*/
#define NCACHE_SIZE 256
/*----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*/
/*A cache chain*/
struct ncache
	{
	/*the MRU end of the cache chain*/
	node_t * mru;
	
	/*the LRU end of the cache chain*/
	node_t * lru;
	
	/*the maximal number of nodes to cache*/
	int size_max;
	
	/*the current length of the cache chain*/
	int size_current;
	
	/*a lock*/
	struct mutex lock;
	};/*struct ncache*/
/*----------------------------------------------------------------------------*/
typedef struct ncache ncache_t;
/*----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*/
/*--------Global Variables----------------------------------------------------*/
/*The cache size (may be overwritten by the user)*/
extern int cache_size;
/*----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*/
/*--------Functions-----------------------------------------------------------*/
/*Initializes the node cache*/
void
ncache_init
	(
	int size_max
	);
/*----------------------------------------------------------------------------*/
/*Looks up the lnode and stores the result in `node`; creates a new entry
	in the cache if the lookup fails*/
error_t
ncache_node_lookup
	(
	lnode_t * lnode,	/*search for this*/
	node_t ** node		/*put the result here*/
	);
/*----------------------------------------------------------------------------*/
/*Resets the node cache*/
void
ncache_reset(void);
/*----------------------------------------------------------------------------*/
/*Adds the given node to the cache*/
void
ncache_node_add
	(
	node_t * node	/*the node to add*/
	);
/*----------------------------------------------------------------------------*/
#endif
